openapi: 3.0.0

info:
  title: Operatto API
  description: API do mini ERP Operatto
  version: 1.0.0

servers:
  - url: http://localhost:3000

tags:
  - name: Health
    description: Verificação de status da API
  - name: Produtos
    description: Cadastro e consulta de produtos
  - name: Pedidos
    description: Operações relacionadas a pedidos
  - name: Estoque
    description: Controle e movimentações de estoque

# =========================
# COMPONENTS (CONTRATOS)
# =========================
components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        details:
          type: array
          items:
            type: object

    Produto:
      type: object
      required:
        - nome
        - unidade_medida
        - preco_venda
      properties:
        nome:
          type: string
          minLength: 3
          example: Pão francês
        descricao:
          type: string
          example: Pão tradicional
        unidade_medida:
          type: string
          example: UN
        preco_venda:
          type: number
          example: 0.75

    CriarPedido:
      type: object
      required:
        - id_cliente
        - itens
      properties:
        id_cliente:
          type: integer
          example: 10
        itens:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - id_produto
              - quantidade
            properties:
              id_produto:
                type: integer
                example: 1
              quantidade:
                type: integer
                example: 2

    AtualizarStatusPedido:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - ABERTO
            - EM_PRODUCAO
            - FINALIZADO
            - CANCELADO

    EstoqueMovimentacao:
      type: object
      required:
        - id_produto
        - quantidade
        - origem
      properties:
        id_produto:
          type: integer
          example: 1
        quantidade:
          type: integer
          example: 10
        origem:
          type: string
          example: ENTRADA
        observacao:
          type: string
          example: Ajuste de estoque inicial

# =========================
# ROTAS
# =========================
paths:

  # -------- HEALTH --------
  /health:
    get:
      tags:
        - Health
      summary: Health check da API
      responses:
        "200":
          description: API funcionando
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  # -------- PRODUTOS --------
  /produtos:
    post:
      tags:
        - Produtos
      summary: Criar produto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Produto"
      responses:
        "201":
          description: Produto criado
        "400":
          description: Dados inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    get:
      tags:
        - Produtos
      summary: Listar produtos
      responses:
        "200":
          description: Lista de produtos

  # -------- PEDIDOS --------
  /pedidos:
    post:
      tags:
        - Pedidos
      summary: Criar pedido
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarPedido"
      responses:
        "201":
          description: Pedido criado
        "400":
          description: Dados inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /pedidos/{id}/status:
    patch:
      tags:
        - Pedidos
      summary: Atualizar status do pedido
      description: |
        Regras:
        - ABERTO → EM_PRODUCAO
        - EM_PRODUCAO → FINALIZADO
        - Qualquer status → CANCELADO
        - FINALIZADO não pode ser alterado
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 6
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarStatusPedido"
      responses:
        "200":
          description: Status atualizado
        "400":
          description: Transição inválida
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Pedido não encontrado

  # -------- ESTOQUE --------
  /movimentacoes/entrada:
    post:
      tags:
        - Estoque
      summary: Entrada de estoque
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EstoqueMovimentacao"
      responses:
        "201":
          description: Entrada registrada
        "400":
          description: Dados inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /movimentacoes/{idProduto}:
    get:
      tags:
        - Estoque
      summary: Listar movimentações por produto
      parameters:
        - name: idProduto
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Lista de movimentações
        "404":
          description: Produto não encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
